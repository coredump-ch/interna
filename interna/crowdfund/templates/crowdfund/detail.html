{% extends 'front/base.html' %}
{% load tabs thumbnail crispy_forms_tags %}

{% block bodyclass %}crowdfund_detail{% endblock %}

{% block navigation %}
    {% activetab 'navigation' 'crowdfund' %}
    {{ block.super }}
{% endblock %}

{% block content %}
    <h1>Crowdfund: {{ object.title }}</h1>

    <p>Funding initiiert{% if object.initiator %} von {{ object.initiator }}{% endif %} am {{ object.created }}.</p>

    <div class="row">
        <div class="col-md-9 project-detail">
            <h2>Details</h2>

            {% thumbnail project.image "500x300" as im %}
                <img src="{{ im.url }}" alt="Picture for project '{{ project.title }}'">
            {% endthumbnail %}

            <div class="description">
                {{ object.long_description|linebreaks }}
            </div>

            <h2>Funders ({{ object.active_promises.count }})</h2>
            {% if object.all_promises %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Betrag</th>
                            <th>Versprochen am</th>
                            <th>Gültig bis</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for promise in object.active_promises %}
                        <tr>
                            <td>{{ promise.name }}</td>
                            <td>{{ promise.amount }} CHF</td>
                            <td>{{ promise.created|date:"Y-m-d" }}</td>
                            <td>{% if promise.expiry_date %}gültig bis {{ promise.expiry_date|date:"Y-m-d" }}{% else %}-{% endif %}</td>
                        </tr>
                        {% endfor %}
                        {% for promise in object.expired_promises %}
                        <tr class="expired">
                            <td>{{ promise.name }}</td>
                            <td>{{ promise.amount }} CHF</td>
                            <td>{{ promise.created|date:"Y-m-d" }}</td>
                            <td>{% if promise.expiry_date %}gültig bis {{ promise.expiry_date|date:"Y-m-d" }}{% else %}-{% endif %}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <p>Vielen Dank!</p>
            {% else %}
                <p>Bisher noch keine Funder. Sei der/die Erste!</p>
            {% endif %}

        </div>
        <div class="col-md-3">
            <h2>Funding</h2>

            <p class="amount-required">Status: {{ object.amount_funded }} von {{ object.amount_required }}
            CHF ({{ object.percent_funded }}%) finanziert durch
            {{ object.active_promises.count }} Personen!</p>

            {% crispy fund_form fund_form.helper %}
        </div>
    </div>
{% endblock %}
